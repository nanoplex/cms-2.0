<polymer-element name="el-component" attributes="data pagename" layout vertical center>
    <template>
        <style>
            :host {
                width: 100%;
            }

            h2,
            .btn,
            label,
            input {
                width: 270px;
            }

            section[data-pagename^=view-] {
                min-height: 60vh;
                margin-top: 5em;
            }

            input {
                border: none;
                border-bottom: 1px solid;
                margin-bottom: 1em;
                padding: 1em 0;
                outline: none;
            }

            .status {
                height: 32px;
            }

        </style>

        <h2>{{Type}}</h2>

        <template repeat="{{prop in Props}}">

            <label for="{{prop.Name}}">{{prop.Name}}</label>

            <template if="{{prop.Type === 'String'}}">
                <input type="text" name="{{prop.Name}}" value="{{prop.Value}}" required />
            </template>

            <template if="{{prop.Type === 'Textbox'}}">
                <textarea name="{{prop.Name}}" required>{{prop.Value}}</textarea>
            </template>

            <template if="{{prop.Type === 'Int32'}}">
                <input type="number" name="{{prop.Name}}" value="{{prop.Value}}" required />
            </template>

            <template if="{{prop.Type === 'Image'}}">
                <input type="file" name="{{prop.Name}}" value="{{prop.Value}}" required />
            </template>

            <!-- lists + textbox in backend -->

        </template>

        <section class="btn" layout horizontal center>
            <p class='status' flex></p>
            <button on-tap="{{finish}}">
                <core-icon icon="check">
                </core-icon>
            </button>
        </section>

    </template>
    <script>
        var propI = 0;

        Polymer({
            ready: function () {
                if (this.data !== undefined) {

                    this._id = this.data._id;
                    this.Type = this.data.Type;
                    this.Frontend = this.data.Frontend;

                    propI = 0;
                    this.Props = [];

                    for (var a in page.Site.Components) {

                        var component = page.Site.Components[a];

                        if (component.Name == this.Type) {

                            for (var b in component.Props) {

                                var prop = component.Props[b];

                                if (prop.Name !== "Type") {

                                    this.Props[propI] = {
                                        "Name": prop.Name,
                                        "Type": prop.Type,
                                        "Value": this.data[prop.Name]
                                    };

                                    propI++;
                                }
                            }

                        }
                    }
                }
            },
            finish: function () {
                var comp = "{",
                    images = document.querySelector("section[data-pagename=view-component] el-component").shadowRoot.querySelectorAll("input[type=file]");

                console.log(images);

                for (var i = 0; i < this.Props.length; i++) {
                    comp += '"' + this.Props[i].Name + '":"' + this.Props[i].Value + '",';
                }

                comp = JSON.parse(comp.replace(/,$/, '') + "}");

                // add
                if (this._id == undefined) {
                    page.$.ajaxAddComponent.body = new FormData();

                    page.$.ajaxAddComponent.body.append("component", JSON.stringify(comp).replace(/"/g, "'"));
                    page.$.ajaxAddComponent.body.append("componentName", this.Type);
                    page.$.ajaxAddComponent.body.append("pageName", this.pagename);

                    for (var a = 0; a < images.length; a++) {
                        for (var b = 0; b < images[a].files.length; b++) {
                            var file = images[a].files[b];

                            page.$.ajaxAddComponent.body.append(file.name, file);
                        }
                    }

                    page.$.ajaxAddComponent.go();
                    page.SelectedPage = "view-loading";
                }
                    // edit
                else {

                }
            },
            data: undefined,
            dataChanged: function () {
                this.ready();
            },
            pagename: undefined,
            _id: undefined,
            Type: undefined,
            Frontend: undefined,
            Props: []
        })
    </script>
</polymer-element>